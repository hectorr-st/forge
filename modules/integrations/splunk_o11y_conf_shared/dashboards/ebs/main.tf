resource "signalfx_time_chart" "byte_utilization_pct" {
  name = "Byte utilization %"

  description  = "Compares delivered bytes to maximum allowed for Nitro volumes"
  program_text = <<-EOF
A = data('EBSByteBalance%').mean(by=['AWSUniqueId']).publish(label='A')
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"
  unit_prefix  = "Metric"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Percent"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  histogram_options {
    color_theme = "gold"
  }

  viz_options {
    axis         = "left"
    display_name = "Byte utilization percentage"
    label        = "A"
    value_suffix = "%"
  }
}

resource "signalfx_time_chart" "write_latency" {
  name         = "Write latency (ms/op)"
  description  = "Estimates average latency per write operation for troubleshooting"
  program_text = <<-EOF
A = data('VolumeTotalWriteTime').sum(by=['VolumeId']).publish(label='A', enable=False)
B = data('VolumeWriteOps').sum(by=['VolumeId']).publish(label='B', enable=False)
C = (A/B * 1000).publish(label='C', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ms/Op"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Intermediate: Write operations count"
    label        = "B"
    value_suffix = "No of ops"
  }
  viz_options {
    axis         = "left"
    color        = "emerald"
    display_name = "Average write latency (ms/op)"
    label        = "C"
    value_unit   = "Millisecond"
  }
  viz_options {
    axis         = "left"
    color        = "gray"
    display_name = "Intermediate: Total write time"
    label        = "A"
    value_unit   = "Millisecond"
  }
}

resource "signalfx_time_chart" "read_ops" {
  name         = "# Read ops"
  description  = "Displays reads performed per interval for EBS volume"
  program_text = <<-EOF
A = data('VolumeReadOps').sum().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision   = 4
  disable_sampling = true
  time_range       = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ops"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Read operations count"
    label        = "A"
    value_suffix = "No of ops"
  }
}

resource "signalfx_time_chart" "write_throughput" {
  name         = "Write throughput"
  description  = "Shows throughput of writes in bytes per time interval"
  program_text = <<-EOF
A = data('VolumeWriteBytes').rate().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Bytes"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Write throughput (bytes/sec)"
    label        = "A"
    value_unit   = "Byte"
  }
}

resource "signalfx_time_chart" "rw_bytes_breakdown" {
  name         = "Read/write bytes breakdown"
  description  = "Compares total bytes read to bytes written across timeline"
  program_text = <<-EOF
A = data('VolumeReadBytes').sum().publish(label='A', enable=True)
B = data('VolumeWriteBytes').sum().publish(label='B', enable=True)
EOF
  plot_type    = "AreaChart"
  color_by     = "Dimension"
  stacked      = true

  axes_precision            = 4
  disable_sampling          = false
  on_chart_legend_dimension = "plot_label"
  time_range                = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Bytes"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Total bytes read"
    label        = "A"
    value_unit   = "Byte"
  }
  viz_options {
    axis         = "left"
    color        = "brown"
    display_name = "Total bytes written"
    label        = "B"
    value_unit   = "Byte"
  }
}

resource "signalfx_time_chart" "read_latency" {
  name         = "Read latency (ms/op)"
  description  = "Estimates average latency per read operation as efficiency measure"
  program_text = <<-EOF
A = data('VolumeTotalReadTime').sum(by=['VolumeId']).publish(label='A', enable=False)
B = data('VolumeReadOps').sum(by=['VolumeId']).publish(label='B', enable=False)
C = (A/B*1000).publish(label='C', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ms/Op"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Read ops per volume (raw)"
    label        = "B"
    value_suffix = "No of ops"
  }
  viz_options {
    axis         = "left"
    color        = "brown"
    display_name = "Average read latency (ms/op)"
    label        = "C"
    value_unit   = "Millisecond"
  }
  viz_options {
    axis         = "left"
    color        = "gray"
    display_name = "Read time per volume (raw)"
    label        = "A"
    value_unit   = "Millisecond"
  }
}

resource "signalfx_time_chart" "read_throughput" {
  name         = "Read throughput"
  description  = "Shows throughput of reads in bytes per time interval"
  program_text = <<-EOF
A = data('VolumeReadBytes').rate().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision   = 4
  disable_sampling = true

  time_range = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Bytes"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Read throughput (bytes/sec)"
    label        = "A"
    value_unit   = "Byte"
  }
}

resource "signalfx_single_value_chart" "state" {
  name         = "State"
  description  = "Indicates availability and current status for workload visibility"
  program_text = <<-EOF
A = data('VolumeReadOps').count(by=['aws_state']).publish(label='A', enable=True)
EOF
  color_by     = "Dimension"

  max_precision           = 4
  secondary_visualization = "Sparkline"

  viz_options {
    display_name = "Volume state reporting count"
    label        = "A"
    value_suffix = "No of ops"
  }
}

resource "signalfx_time_chart" "total_read_time" {
  name         = "Total read time"
  description  = "Total seconds spent in servicing read operations"
  program_text = <<-EOF
A = data('VolumeTotalReadTime').sum().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Seconds"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Total time spent reading"
    label        = "A"
    value_unit   = "Millisecond"
  }
}

resource "signalfx_time_chart" "latency_op" {
  name         = "Latency/op (ms)"
  description  = ""
  program_text = <<-EOF
A = data('VolumeWriteOps', filter=filter('namespace', 'AWS/EBS') and filter('VolumeId', 'vol-46dcc55f') and filter('stat', 'sum'), extrapolation='zero', rollup='rate').scale(60).publish(label='A')
B = data('VolumeTotalWriteTime', filter=filter('namespace', 'AWS/EBS') and filter('VolumeId', 'vol-46dcc55f') and filter('stat', 'sum'), extrapolation='zero', rollup='rate').scale(60).publish(label='B', enable=False)
C = data('VolumeReadOps', filter=filter('namespace', 'AWS/EBS') and filter('VolumeId', 'vol-46dcc55f') and filter('stat', 'sum'), extrapolation='zero', rollup='rate').scale(60).publish(label='C')
D = data('VolumeTotalReadTime', filter=filter('namespace', 'AWS/EBS') and filter('VolumeId', 'vol-46dcc55f') and filter('stat', 'sum'), extrapolation='zero', rollup='rate').scale(60).publish(label='D', enable=False)
E = (B/A).scale(1000).publish(label='E')
F = (D/C).scale(1000).publish(label='F')
EOF
  plot_type    = "ColumnChart"
  color_by     = "Dimension"

  axes_precision = 0
  time_range     = 7200

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ms/write - BLUE"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = 0
  }

  axis_right {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ms/read - RED"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = 0
  }

  histogram_options {
    color_theme = "gold"
  }

  viz_options {
    axis         = "left"
    display_name = "Volumereadops - scale:60"
    label        = "C"
  }
  viz_options {
    axis         = "left"
    display_name = "Volumetotalreadtime - scale:60"
    label        = "D"
  }
  viz_options {
    axis         = "left"
    display_name = "Volumetotalwritetime - scale:60"
    label        = "B"
  }
  viz_options {
    axis         = "left"
    display_name = "Volumewriteops - scale:60"
    label        = "A"
  }
  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Millisec/write"
    label        = "E"
  }
  viz_options {
    axis         = "right"
    color        = "brown"
    display_name = "Millisec/read"
    label        = "F"
  }
}

resource "signalfx_time_chart" "total_write_time" {
  name         = "Total write time"
  description  = "Total seconds spent in servicing write operations"
  program_text = <<-EOF
A = data('VolumeTotalWriteTime').sum().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Seconds"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "azure"
    display_name = "Total write time"
    label        = "A"
    value_unit   = "Millisecond"
  }
}

resource "signalfx_time_chart" "read_vs_write_ops" {
  name         = "Read vs write ops"
  description  = "Visualizes relative load of read and write ops over time"
  program_text = <<-EOF
A = data('VolumeReadOps').sum().publish(label='A', enable=True)
B = data('VolumeWriteOps').sum().publish(label='B', enable=True)
EOF
  plot_type    = "AreaChart"
  color_by     = "Dimension"

  axes_precision            = 4
  disable_sampling          = false
  on_chart_legend_dimension = "plot_label"
  time_range                = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ops"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Read operations"
    label        = "A"
    value_suffix = "No of ops"
  }
  viz_options {
    axis         = "left"
    color        = "brown"
    display_name = "Write operations"
    label        = "B"
    value_suffix = "No of ops"
  }
}

resource "signalfx_time_chart" "avg_queue_length" {
  name         = "Average queue length"
  description  = "Measures operations awaiting completion, highlighting saturation"
  program_text = <<-EOF
A = data('VolumeQueueLength').mean().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Queue length"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Average volume queue length"
    label        = "A"
    value_suffix = "No of ops"
  }
}

resource "signalfx_time_chart" "idle_time" {
  name         = "Idle time"
  description  = "Indicates when disk is idle and not serving I/O"
  program_text = <<-EOF
A = data('VolumeIdleTime').sum().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Seconds"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Total idle time"
    label        = "A"
    value_unit   = "Millisecond"
  }
}

resource "signalfx_time_chart" "write_ops" {
  name         = "# Write ops"
  description  = "Displays writes performed per interval for EBS volume"
  program_text = <<-EOF
A = data('VolumeWriteOps').sum().publish(label='A', enable=True)
EOF
  plot_type    = "LineChart"
  color_by     = "Dimension"

  axes_precision = 4
  time_range     = 900

  axis_left {
    high_watermark = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    label          = "Ops"
    low_watermark  = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    max_value      = 179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    min_value      = -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  }

  viz_options {
    axis         = "left"
    color        = "blue"
    display_name = "Number of write operations"
    label        = "A"
    value_suffix = "No of ops"
  }
}
resource "signalfx_dashboard" "ebs" {
  name            = "EBS"
  description     = "EC2/EBS volume throughput, IOPS, and latency for Forge runners."
  dashboard_group = var.dashboard_group

  variable {
    property               = "aws_tag_TenantName"
    alias                  = "ForgeCICD Tenant Name"
    description            = ""
    values                 = []
    value_required         = false
    values_suggested       = var.tenant_names
    restricted_suggestions = true
  }

  dynamic "variable" {
    for_each = var.dynamic_variables
    iterator = var_def

    content {
      property               = var_def.value.property
      alias                  = var_def.value.alias
      description            = var_def.value.description
      values                 = var_def.value.values
      value_required         = var_def.value.value_required
      values_suggested       = var_def.value.values_suggested
      restricted_suggestions = var_def.value.restricted_suggestions
    }
  }

  chart {
    chart_id = signalfx_single_value_chart.state.id
    column   = 0
    row      = 0
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.read_ops.id
    column   = 4
    row      = 0
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.write_ops.id
    column   = 8
    row      = 0
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.write_latency.id
    column   = 8
    row      = 1
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.read_latency.id
    column   = 4
    row      = 1
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.latency_op.id
    column   = 0
    row      = 1
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.read_vs_write_ops.id
    column   = 0
    row      = 2
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.write_throughput.id
    column   = 8
    row      = 2
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.read_throughput.id
    column   = 4
    row      = 2
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.rw_bytes_breakdown.id
    column   = 0
    row      = 3
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.total_read_time.id
    column   = 4
    row      = 3
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.total_write_time.id
    column   = 8
    row      = 3
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.byte_utilization_pct.id
    column   = 0
    row      = 4
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.idle_time.id
    column   = 8
    row      = 4
    width    = 4
    height   = 1
  }

  chart {
    chart_id = signalfx_time_chart.avg_queue_length.id
    column   = 4
    row      = 4
    width    = 4
    height   = 1
  }

}
